
  pipeline {
      agent any
      environment {
        Docker_Tag = "getversion()"
        }
      stages{
          stage('Cloning Git') {
              steps{
                git branch: 'main', url: 'https://github.com/Azeem-Haider/testing.git'              
              }
            }
          stage('testing'){
              steps{
                echo "testing"   
              }
              
           }
           stage('Building image') {
               steps{
                    myapp = docker.build("azeem0322/backend_api:${Docker_Tag}")
               }
           }
            stage('dockerHub push') {
               steps{
                docker.withRegistry('https://registry.hub.docker.com', 'dockerHub') {
                            myapp.push("latest")
                            myapp.push("${Docker_Tag}")
                    }
               }
            }
        }
          
    }
    
    
    
    def getversion(){
        def commitId=sh returnStdout: true, script: 'git rev-parse --short HEAD'
        return commitId
    }
